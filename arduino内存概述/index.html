<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta name="twitter:card" content="summary" />

    <meta name="twitter:title" content="Arduino内存概述" />
    <meta name="twitter:description" content="" />
    <meta name="twitter:site" content="@" />

    <meta property="og:title" content="Arduino内存概述 &middot; Blog" />
    <meta property="og:site_name" content="Blog" />
    <meta
      property="og:url"
      content="https://Jokernol.github.io/arduino%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0/"
    />

    <meta property="og:image" content="/images/cover.jpg" />

    <meta property="og:description" content="" />
    <meta property="og:type" content="article" />
    <meta
      property="article:published_time"
      content="2021-05-07T11:41:55&#43;08:00"
    />

    <title>Arduino内存概述 &middot; Blog</title>

    <meta name="description" content="关于内存" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link
      rel="shortcut icon"
      href="https://Jokernol.github.io/images/favicon.ico"
    />
    <link
      rel="apple-touch-icon"
      href="https://Jokernol.github.io/images/apple-touch-icon.png"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="https://Jokernol.github.io/css/screen.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://Jokernol.github.io/css/nav.css"
    />

    <link
      href="https://Jokernol.github.io/index.xml"
      rel="alternate"
      type="application/rss+xml"
      title="Blog"
    />

    <meta name="generator" content="Hugo 0.83.1" />

    <link
      rel="canonical"
      href="https://Jokernol.github.io/arduino%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0/"
    />

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "publisher": {
          "@type": "Organization",
          "name": null,
          "logo": "https://Jokernol.github.io/images/logo.jpg"
        },
        "author": {
          "@type": "Person",
          "name": null,

          "image": {
            "@type": "ImageObject",
            "url": "https://Jokernol.github.io/images/logo.jpg",
            "width": 250,
            "height": 250
          },

          "url": null,
          "sameAs": []
        },
        "headline": "Arduino内存概述",
        "name": "Arduino内存概述",
        "wordCount": 215,
        "timeRequired": "PT2M",
        "inLanguage": {
          "@type": "Language",
          "alternateName": "en"
        },
        "url": "https://Jokernol.github.io/arduino%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0/",
        "datePublished": "2021-05-07T11:41Z",
        "dateModified": "2021-05-07T11:41Z",

        "description": "",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://Jokernol.github.io/arduino%E5%86%85%E5%AD%98%E6%A6%82%E8%BF%B0/"
        }
      }
    </script>
  </head>
  <body class="nav-closed">
    <div class="nav">
      <h3 class="nav-title">Menu</h3>
      <a href="#" class="nav-close">
        <span class="hidden">Close</span>
      </a>
      <ul>
        <br />
        <li class="nav-opened" role="presentation">
          <a href="https://Jokernol.github.io/">Home</a>
        </li>

        <br />
        <li class="nav-opened" role="presentation">
          <a href="https://Jokernol.github.io/post">Blog</a>
        </li>

        <br />
        <li class="nav-opened" role="presentation">
          <a href="https://Jokernol.github.io/about">About</a>
        </li>
      </ul>

      <a
        class="subscribe-button icon-feed"
        href="https://Jokernol.github.io/index.xml"
        >Subscribe</a
      >
    </div>
    <span class="nav-cover"></span>

    <div class="site-wrapper">
      <header class="main-header post-head no-cover">
        <nav class="main-nav clearfix">
          <a class="blog-logo" href="https://Jokernol.github.io/"
            ><img src="https://Jokernol.github.io/images/logo.jpg" alt="Home"
          /></a>

          <a class="menu-button" href="#"
            ><span class="burger">&#9776;</span
            ><span class="word">Menu</span></a
          >
        </nav>
      </header>

      <main class="content" role="main">
        <article class="post post">
          <header class="post-header">
            <h1 class="post-title">Arduino内存概述</h1>
            <small></small>

            <section class="post-meta">
              <time class="post-date" datetime="2021-05-07T11:41:55&#43;08:00">
                May 7, 2021
              </time>
            </section>
          </header>

          <section class="post-content">
            <h3 id="处理器内存结构">处理器/内存结构</h3>
            <p>
              在电子计算机的早期，出现了两种不同的处理器/内存结构：哈佛结构和冯诺依曼结构。
            </p>
            <h4 id="冯诺依曼结构">冯诺依曼结构</h4>
            <p>
              冯·诺依曼结构也称普林斯顿结构，是一种将程序指令存储器和数据存储器合并在一起的存储器结构。程序指令存储地址和数据存储地址指向同一个存储器的不同物理位置，因此程序指令和数据的宽度相同，如英特尔公司的8086中央处理器的程序指令和数据都是16位宽。
            </p>
            <h4 id="哈佛结构">哈佛结构</h4>
            <p>
              哈佛结构是一种将程序指令存储和数据存储分开的存储器结构。哈佛结构是一种并行体系结构，它的主要特点是将程序和数据存储在不同的存储空间中，即程序存储器和数据存储器是两个独立的存储器，每个存储器独立编址、独立访问。中央处理器首先到程序指令存储器中读取程序指令内容，解码后得到数据地址，再到相应的数据存储器中读取数据，并进行下一步的操作（通常是执行）。程序指令存储和数据存储分开，可以使指令和数据有不同的数据宽度，如Microchip公司的PIC16芯片的程序指令是14位宽度，而数据是8位宽度。
            </p>
            <h4 id="优劣">优劣</h4>
            <p>
              每种架构都有其优势：在所有其他条件相同的情况下，哈佛模型在性能方面具有优势。冯·诺依曼模型更具有拓展性。
            </p>
            <h4 id="微控制器">微控制器</h4>
            <p>
              诸如为Arduinos提供动力的微控制器是为嵌入式应用程序而设计的。与通用计算机不同，嵌入式处理器通常具有定义明确的任务，它必须以最低的成本可靠高效地执行，微控制器设计趋于精简。他们放弃了繁复的多层缓存和基于磁盘的虚拟内存系统，只保留了完成任务所必需的部分。
            </p>
            <h3 id="arduino-uno-内存概述">Arduino UNO 内存概述</h3>
            <p>
              事实证明，哈佛模型非常适合嵌入式应用程序。Arduino
              UNO中使用的Atmega
              328使用的是相对纯粹的哈佛架构。程序存储在Flash中，而数据存储在SRAM中。
            </p>
            <p>Arduino中有三种类型的内存：</p>
            <ul>
              <li>Flash</li>
              <li>SRAM</li>
              <li>EEPROM</li>
            </ul>
            <h4 id="flash">Flash</h4>
            <p>
              Flash用于存储程序映像和所有初始化的数据。您可以从Flash执行程序代码，但不能从正在执行的代码修改Flash中的数据。要修改数据，必须首先将其复制到SRAM中。Flash和SD卡所使用的技术相同。它是非易失性的，因此在关闭系统电源后，您的程序仍将存在。
            </p>
            <h4 id="sram">SRAM</h4>
            <p>
              SRAM(Static Random Access
              Memory)，可以被正在执行的程序读取和写入。<br />
              程序运行时，SRAM具有以下几种作用：
            </p>
            <ul>
              <li>
                静态数据(Static data) -为程序中所有全局变量和静态变量保留的空间
              </li>
              <li>
                堆(Heap)
                -堆用于动态数据的分配，随着数据的不断分配，堆从静态数据的顶部向上增长
              </li>
              <li>
                栈(Stack)
                -栈用于局部变量，并用于维护中断和函数调用的记录。栈从内存顶部开始向下扩展到堆。每个中断，函数调用和局部变量分配都会导致栈增长。而从中断或函数调用返回将回收该中断或函数使用的所有栈空间。
              </li>
            </ul>
            <p>
              大部分的内存问题都源于堆栈冲突，当发生冲突时内存将会发生无法预知的损坏。较好的情况下，它会立即崩溃。而在其他情况下，冲突所导致的危害可能要到很久以后才会被注意到。所以我们必须谨慎。
            </p>
            <h4 id="eeprom">EEPROM</h4>
            <p>
              EEPROM是另一种非易失性储存器，可以从正在执行的程序中读取或写入。但EEPROM只能一个字节一个字节的读取，所以使用起来有点尴尬。虽然它不能取代珍贵的SRAM,但有时会非常有用。
            </p>
            <table>
              <thead>
                <tr>
                  <th style="text-align: center">种类</th>
                  <th style="text-align: center">用途</th>
                  <th style="text-align: center">容量</th>
                  <th style="text-align: center">易失性</th>
                  <th style="text-align: center">其他</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="text-align: center">Flash</td>
                  <td style="text-align: center">
                    程序，引导程序，只读用户数据
                  </td>
                  <td style="text-align: center">32KB(包括.5k用于引导程序)</td>
                  <td style="text-align: center">非易失性</td>
                  <td style="text-align: center">
                    上传sketch后无法更改用户数据
                  </td>
                </tr>
                <tr>
                  <td style="text-align: center">SRAM</td>
                  <td style="text-align: center">用户数据</td>
                  <td style="text-align: center">2KB</td>
                  <td style="text-align: center">易失性</td>
                  <td></td>
                </tr>
                <tr>
                  <td style="text-align: center">EEPROM</td>
                  <td style="text-align: center">用户数据</td>
                  <td style="text-align: center">1KB</td>
                  <td style="text-align: center">易失性</td>
                  <td></td>
                </tr>
              </tbody>
            </table>
            <h3 id="测量内存使用率">测量内存使用率</h3>
            <h4 id="flash-1">Flash</h4>
            <p>
              测量Flash的使用率非常简单，每次编译时，编译器都会自动测量并输出在终端中。
            </p>
            <h4 id="eeprom-1">EEPROM</h4>
            <p>
              程序员具有EEPROM的完全控制权。读写的每一个字节都由程序员掌控。
            </p>
            <pre><code>// ************************************************
// Write floating point values to EEPROM
// ************************************************
void EEPROM_writeDouble(int address, double value) {
    byte* p = (byte*)(void*)&amp;value;
    for (int i = 0; i &lt; sizeof(value); i++) {
        EEPROM.write(address++, *p++);
    }
}

// ************************************************
// Read floating point values from EEPROM
// ************************************************
double EEPROM_readDouble(int address) {
    double value = 0.0;
    byte* p = (byte*)(void*)&amp;value;
    for (int i = 0; i &lt; sizeof(value); i++) {
        *p++ = EEPROM.read(address++);
    }
    return value;
}
</code></pre>
            <h4 id="sram-1">SRAM</h4>
            <p>
              SRAM的使用更加动态因此测量起来更为困难。为了准确测量SRAM的使用我们可以采用下方的<code>freeMemory()</code>函数。<br />
              由于SRAM的使用是动态的并且随着时间而变化，因此我们可以在程序的不同位置调用该函数来观察SRAM的使用情况。
            </p>
            <pre><code>#ifdef __arm__
// should use uinstd.h to define sbrk but Due causes a conflict
extern &quot;C&quot; char* sbrk(int incr);
#else // __ARM__
extern char *__brkval;
#endif // __arm__
int freeMemory() {
    char top;
#ifdef __arm__
    return &amp;top - reinterpret_cast&lt;char*&gt;(sbrk(0));
#elif defined(CORE_TEENSY) || (ARDUINO &gt; 103 &amp;&amp; ARDUINO != 151)
    return &amp;top - __brkval;
#else // __arm__
    return __brkval ? &amp;top - __brkval : &amp;top - __malloc_heap_start;
#endif // __arm__
}
</code></pre>
            <p>
              <code>freeMemory()</code
              >实际返回的是堆和栈之间的空余空间，通过监视空余空间的大小来避免堆栈冲突是十分有效的
            </p>
            <h3 id="oled">OLED</h3>
            <p>
              OLED屏的使用需要耗费大量的SRAM空间。<br />
              对于单色OLED显示器，每八个像素需要一个字节。<br />
              128x64需要1KB的SRAM空间。<br />
              128x32需要512B的SRAM空间。
            </p>
          </section>

          <footer class="post-footer">
            <section class="share">
              <h4>Share this post</h4>
              <a
                class="icon-twitter"
                style="font-size: 1.4em"
                href="https://twitter.com/share?text=Arduino%e5%86%85%e5%ad%98%e6%a6%82%e8%bf%b0&nbsp;-&nbsp;Blog&amp;url=https%3a%2f%2fJokernol.github.io%2farduino%25E5%2586%2585%25E5%25AD%2598%25E6%25A6%2582%25E8%25BF%25B0%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;"
              >
                <span class="hidden">Twitter</span>
              </a>
              <a
                class="icon-facebook"
                style="font-size: 1.4em"
                href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fJokernol.github.io%2farduino%25E5%2586%2585%25E5%25AD%2598%25E6%25A6%2582%25E8%25BF%25B0%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;"
              >
                <span class="hidden">Facebook</span>
              </a>
              <a
                class="icon-pinterest"
                style="font-size: 1.4em"
                href="http://pinterest.com/pin/create/button/?url=https%3a%2f%2fJokernol.github.io%2farduino%25E5%2586%2585%25E5%25AD%2598%25E6%25A6%2582%25E8%25BF%25B0%2f&amp;description=Arduino%e5%86%85%e5%ad%98%e6%a6%82%e8%bf%b0"
                onclick="window.open(this.href, 'pinterest-share','width=580,height=296');return false;"
              >
                <span class="hidden">Pinterest</span>
              </a>
              <a
                class="icon-google-plus"
                style="font-size: 1.4em"
                href="https://plus.google.com/share?url=https%3a%2f%2fJokernol.github.io%2farduino%25E5%2586%2585%25E5%25AD%2598%25E6%25A6%2582%25E8%25BF%25B0%2f"
                onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;"
              >
                <span class="hidden">Google+</span>
              </a>
            </section>
          </footer>
        </article>
      </main>

      <aside class="read-next">
        <a
          class="read-next-story prev"
          style="no-cover"
          href="https://Jokernol.github.io/welcome/"
        >
          <section class="post">
            <h2>Welcome</h2>
          </section>
        </a>
      </aside>

      <footer class="site-footer clearfix">
        <section class="copyright"><a href="">Blog</a> © Jokernol 2021</section>
      </footer>
    </div>
    <script
      type="text/javascript"
      src="https://Jokernol.github.io/js/jquery.js"
    ></script>
    <script
      type="text/javascript"
      src="https://Jokernol.github.io/js/jquery.fitvids.js"
    ></script>
    <script
      type="text/javascript"
      src="https://Jokernol.github.io/js/index.js"
    ></script>
  </body>
</html>
